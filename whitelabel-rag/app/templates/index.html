<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#1976d2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/static/manifest.json">
    <title>WhiteLabelRAG - Document Q&A Assistant</title>
    
    <!-- Google Fonts for better typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/color-palette.css">
    <link rel="stylesheet" href="/static/css/bootstrap-style-guide.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/enhancements.css">
    <link rel="stylesheet" href="/static/css/mobile.css">
    <!-- Uncomment during development to see color examples -->
    <!-- <link rel="stylesheet" href="/static/css/color-examples.css"> -->
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <!-- Added viewport height fix for mobile and typography improvements -->
    <style>
        :root {
            /* Primary palette - Material Design inspired */
            --primary-color: #1976d2;
            --primary-light: #4791db;
            --primary-dark: #115293;
            --secondary-color: #546e7a;
            --secondary-light: #819ca9;
            --secondary-dark: #29434e;
            
            /* Status colors */
            --success-color: #2e7d32;
            --success-light: #4caf50;
            --danger-color: #d32f2f;
            --danger-light: #ef5350;
            --warning-color: #f57c00;
            --warning-light: #ffb74d;
            --info-color: #0288d1;
            --info-light: #4fc3f7;
            
            /* Background colors */
            --background-color: #fff;
            --light-color: #fff;
            --dark-color: #333333;
            --text-color: #333333;
            --border-color: #000080;
            
            /* UI elements */
            --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --shadow-md: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --transition-speed: 0.3s;
            --vh: 1vh; /* Used for mobile height fix */
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.5;
            color: var(--text-color);
            background-color: var(--background-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        code, pre, .monospace {
            font-family: 'JetBrains Mono', monospace;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
        }
        
        .font-medium {
            font-weight: 500;
        }
        
        .font-semibold {
            font-weight: 600;
        }
        
        .btn {
            font-weight: 500;
            letter-spacing: 0.01em;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover, 
        .btn-primary:focus {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .text-primary {
            color: var(--primary-color) !important;
        }
        
        .text-success {
            color: var(--success-color) !important;
        }
        
        .text-danger {
            color: var(--danger-color) !important;
        }
        
        .text-warning {
            color: var(--warning-color) !important;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        /* Better glass effect for dark mode */
        @media (prefers-color-scheme: dark) {
            .glass-effect {
                background: rgba(255, 255, 255, 0.85);
                border: 1px solid var(--border-color);
                box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            }
        }
        
        .bg-primary-gradient {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }
        
        @media (max-width: 767.98px) {
            .mobile-order-1 { order: 1; }
            .mobile-order-2 { order: 2; }
            .vh-minus-header { height: calc(100vh - 56px); }
        }
        
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
        
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* Dark mode variable overrides to ensure text readability */
        @media (prefers-color-scheme: dark) {
            :root {
                /* Keep dark text colors for all panels */
                --light-color: #fff;
                --dark-color: #333333;
                --text-color: #333333;
                --border-color: #000080;
            }
        }
        
        /* Workflow Waypoints */
        .workflow-waypoints {
            position: relative;
            padding: 1rem 0;
        }
        
        .workflow-track {
            height: 4px;
            background-color: #fff;
            border-radius: 2px;
            position: relative;
        }
        
        .workflow-progress {
            position: absolute;
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        .waypoint {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #fff;
            border: 2px solid #fff;
            position: absolute;
            top: -6px;
            transform: translateX(-50%);
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .waypoint.active {
            background-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.2);
        }
        
        .waypoint.completed {
            background-color: var(--success-color);
        }
        
        .waypoint-label {
            position: absolute;
            top: 18px;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--secondary-color);
            text-align: center;
            width: 80px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .waypoint-label.active {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Modern layout improvements */
        .full-height {
            height: 100vh;
            max-height: 100vh;
        }
        
        .chat-section-modern {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            background-color: white;
        }
        
        /* Message styling */
        .message {
            max-width: 85%;
            margin-bottom: 1.25rem;
            position: relative;
        }
        
        .message-user {
            align-self: flex-end;
        }
        
        .message-assistant {
            align-self: flex-start;
        }
        
        .message-content {
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            position: relative;
            line-height: 1.5;
            box-shadow: var(--shadow-sm);
        }
        
        .message-user .message-content {
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
        
        .message-assistant .message-content {
            background-color: white;
            color: var(--dark-color);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 0.25rem;
        }
        
        .message-meta {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            color: var(--secondary-color);
        }
        
        .message-sources {
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.75rem;
        }
        
        .message-assistant .message-sources {
            border-top-color: var(--border-color);
        }
        
        .source-tag {
            display: inline-block;
            background-color: rgba(255,255,255,0.2);
            border-radius: 1rem;
            padding: 0.125rem 0.5rem;
            margin: 0.125rem;
            font-size: 0.7rem;
        }
        
        .message-assistant .source-tag {
            background-color: var(--light-color);
            color: var(--secondary-color);
        }
        
        /* Task step styling */
        .task-step {
            padding: 1rem;
            border-radius: 8px;
            background-color: white;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .task-step.active {
            background-color: rgba(25, 118, 210, 0.05);
            border-left: 3px solid var(--primary-color);
        }
        
        .task-step.completed {
            background-color: rgba(46, 125, 50, 0.05);
            border-left: 3px solid var(--success-color);
        }
        
        .step-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 1rem;
            background-color: var(--light-color);
            color: var(--primary-color);
        }
        
        .task-step.completed .step-icon {
            color: var(--success-color);
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--dark-color);
        }
        
        .step-description {
            font-size: 0.825rem;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        .step-progress {
            width: 100%;
            height: 4px;
            background-color: var(--light-color);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .step-progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .task-step.completed .step-progress-bar {
            background-color: var(--success-color);
            width: 100% !important;
        }
        
        /* File item styling */
        .file-item {
            padding: 0.75rem;
            border-radius: 8px;
            background-color: white;
            border: 1px solid var(--border-color);
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
        }
        
        .file-item:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }
        
        .file-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: var(--dark-color);
        }
        
        .file-meta {
            font-size: 0.75rem;
            color: var(--secondary-color);
        }
        
        /* Status styling */
        .stat-item {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .stat-item:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--secondary-color);
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid h-100 p-0 d-flex flex-column">
        <!-- Responsive navbar for xs and sm screens, hidden on larger screens -->
        <nav class="navbar navbar-expand-md navbar-light bg-white shadow-sm py-2 d-md-none">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="bi bi-robot text-primary"></i> WhiteLabelRAG
                </a>
                <div class="connection-status ms-auto me-2" id="mobileConnectionStatus">
                    <i class="bi bi-circle-fill text-warning"></i>
                    <span>Connecting...</span>
                </div>
                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarCollapse">
                    <i class="bi bi-three-dots-vertical"></i>
                </button>
            </div>
        </nav>
        
        <div class="row g-0 flex-grow-1 overflow-hidden">
            <!-- Main Chat Area - responsive across all 5 breakpoints -->
            <div class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-9 d-flex flex-column mobile-order-2 h-100">
                <div class="chat-section chat-section-modern bg-white shadow-sm rounded-3 m-2 flex-grow-1 d-flex flex-column h-100">
                    <!-- Header with responsive spacing - visible only on md and up -->
                    <div class="chat-header d-none d-md-flex justify-content-between align-items-center p-3 border-bottom">
                        <h2 class="m-0 fs-4"><i class="bi bi-robot text-primary me-2"></i>WhiteLabelRAG</h2>
                        <div class="connection-status" id="connectionStatus">
                            <i class="bi bi-circle-fill text-warning"></i>
                            <span>Connecting...</span>
                        </div>
                    </div>
                    
                    <!-- Workflow Waypoints - Process Visualization -->
                    <div class="workflow-waypoints mx-3 mt-3 mb-1 d-none" id="workflowWaypoints">
                        <div class="workflow-track">
                            <div class="workflow-progress" id="workflowProgress" style="width: 0%"></div>
                            <!-- Waypoints will be added dynamically via JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Status Badge with improved styling -->
                    <div class="status-badge glass-effect mx-3 my-2 rounded-3 p-2 transition-all" id="statusBadge" style="display: none;">
                        <div class="status-indicator me-2" id="statusIndicator"></div>
                        <div class="status-content flex-grow-1">
                            <div class="status-text fw-medium" id="statusText">Processing...</div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Task execution steps container -->
                    <div class="task-steps-container px-3 d-none" id="taskStepsContainer">
                        <div class="task-steps" id="taskSteps">
                            <!-- Task steps will be added dynamically via JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Chat Container with flex-grow to fill available space -->
                    <div class="chat-container flex-grow-1 p-3 overflow-auto custom-scrollbar" id="chatContainer">
                        <div class="welcome-message">
                            <div class="text-center py-4">
                                <i class="bi bi-robot display-4 text-primary"></i>
                                <h4 class="mt-3">Welcome to WhiteLabelRAG!</h4>
                                <p class="text-muted mx-auto" style="max-width: 600px;">
                                    I'm your AI assistant with document search capabilities. 
                                    Upload documents and ask me questions about them, or just have a conversation!
                                </p>
                                <div class="quick-actions d-flex flex-wrap justify-content-center gap-2 mt-4">
                                    <button class="btn btn-outline-primary btn-sm shadow-sm transition-all" onclick="app.sendQuickMessage('What can you do?')">
                                        <i class="bi bi-question-circle me-1"></i> What can you do?
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm shadow-sm transition-all" onclick="app.sendQuickMessage('Show me system stats')">
                                        <i class="bi bi-bar-chart me-1"></i> System Stats
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm shadow-sm transition-all" onclick="app.sendQuickMessage('List my files')">
                                        <i class="bi bi-files me-1"></i> List Files
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Input with improved responsive design -->
                    <form class="chat-form p-3 border-top" id="chatForm">
                        <div class="input-group">
                            <textarea 
                                class="form-control chat-input rounded-start shadow-sm"
                                id="messageInput" 
                                placeholder="Ask me anything about your documents..."
                                rows="1"
                            ></textarea>
                            <button class="btn btn-primary rounded-end px-3 d-flex align-items-center justify-content-center shadow-sm" 
                                    type="submit" id="sendButton" style="width: 50px;">
                                <i class="bi bi-send-fill"></i>
                            </button>
                        </div>
                        <div class="form-text small text-muted mt-2">
                            <i class="bi bi-info-circle-fill me-1"></i> 
                            Press Shift+Enter for a new line, Enter to send
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Sidebar - responsive across all 5 breakpoints -->
            <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-3 d-flex flex-column mobile-order-1 h-100">
                <!-- Collapsible sidebar for mobile -->
                <div class="collapse d-md-none" id="sidebarCollapse">
                    <div class="glass-effect bg-white shadow-sm rounded-3 m-2 p-3">
                        <!-- Mobile sidebar content -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="m-0"><i class="bi bi-gear-fill text-primary me-2"></i>Controls</h5>
                            <button class="btn-close" data-bs-toggle="collapse" data-bs-target="#sidebarCollapse"></button>
                        </div>
                        
                        <div class="quick-nav d-flex flex-wrap gap-2 mb-3">
                            <button class="btn btn-sm btn-outline-primary w-100 shadow-sm" data-bs-toggle="collapse" data-bs-target="#uploadCollapse">
                                <i class="bi bi-cloud-upload me-1"></i> Upload Documents
                            </button>
                            <button class="btn btn-sm btn-outline-secondary w-100 shadow-sm" data-bs-toggle="collapse" data-bs-target="#filesCollapse">
                                <i class="bi bi-files me-1"></i> Your Documents
                            </button>
                            <button class="btn btn-sm btn-outline-danger w-100 shadow-sm" id="mobileClearChat">
                                <i class="bi bi-trash me-1"></i> Clear Chat
                            </button>
                        </div>
                        
                        <!-- Collapsible sections for mobile -->
                        <div class="collapse show" id="uploadCollapse">
                            <div class="upload-section mb-3 border-bottom pb-3">
                                <h6 class="d-flex align-items-center mb-2">
                                    <i class="bi bi-cloud-upload text-primary me-2"></i>Upload Documents
                                </h6>
                                <form id="mobileUploadForm" enctype="multipart/form-data">
                                    <div class="upload-dropzone mb-2">
                                        <i class="bi bi-cloud-upload"></i>
                                        <p class="mb-2 small">Tap to upload files</p>
                                        <input type="file" class="form-control form-control-sm d-none" id="mobileFileInput" multiple 
                                               accept=".pdf,.docx,.txt,.md,.csv,.jpg,.jpeg,.png,.gif,.bmp,.mp3,.wav,.mp4,.avi,.mov">
                                    </div>
                                    <button type="submit" class="btn btn-success btn-sm w-100 shadow-sm">
                                        <i class="bi bi-upload me-1"></i>Upload & Process
                                    </button>
                                </form>
                                <div id="mobileUploadStatus" class="mt-2 small"></div>
                            </div>
                        </div>
                        
                        <div class="collapse" id="filesCollapse">
                            <div class="files-section mb-3 border-bottom pb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="m-0"><i class="bi bi-files me-2"></i>Your Documents</h6>
                                    <button class="btn btn-outline-secondary btn-sm rounded-circle" id="mobileRefreshFiles">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                                <div id="mobileFilesList">
                                    <div class="text-muted small">Loading files...</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Stats for mobile with progress indicator -->
                        <div class="stats-section d-flex flex-wrap">
                            <div class="stat-item p-2 text-center flex-grow-1 bg-light rounded shadow-sm me-2">
                                <div class="stat-value fw-bold" id="mobileDocCount">0</div>
                                <div class="stat-label small">Documents</div>
                                <div class="progress mt-1" style="height: 3px;">
                                    <div class="progress-bar" style="width: 0%" id="mobileDocProgress"></div>
                                </div>
                            </div>
                            <div class="stat-item p-2 text-center flex-grow-1 bg-light rounded shadow-sm">
                                <div class="stat-value fw-bold" id="mobileSystemStatus">Ready</div>
                                <div class="stat-label small">Status</div>
                                <div class="progress mt-1" style="height: 3px;">
                                    <div class="progress-bar bg-success" style="width: 100%" id="mobileStatusProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop sidebar - hidden on xs and sm -->
                <div class="sidebar glass-effect bg-white shadow-sm rounded-3 m-2 p-3 d-none d-md-block flex-grow-1 overflow-auto">
                    <!-- File Upload Section with improved visual design -->
                    <div class="upload-section mb-4">
                        <h5 class="d-flex align-items-center border-bottom pb-2 mb-3">
                            <i class="bi bi-cloud-upload text-primary me-2"></i>Upload Documents
                        </h5>
                        <form id="uploadForm" enctype="multipart/form-data">
                            <div class="upload-dropzone mb-3">
                                <i class="bi bi-cloud-upload"></i>
                                <p class="mb-2">Drag files here or click to upload</p>
                                <input type="file" class="form-control form-control-sm d-none" id="fileInput" multiple 
                                       accept=".pdf,.docx,.txt,.md,.csv,.jpg,.jpeg,.png,.gif,.bmp,.mp3,.wav,.mp4,.avi,.mov">
                                <div class="small text-muted">
                                    Supported: PDF, Word, Text, Markdown, CSV, Images, Audio, Video (max 16MB each)
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success btn-sm w-100 shadow-sm transition-all">
                                <i class="bi bi-upload me-2"></i>Upload & Process
                            </button>
                        </form>
                        <div id="uploadStatus" class="mt-2"></div>
                    </div>
                    
                    <!-- Files List with modern card design -->
                    <div class="files-section mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="m-0"><i class="bi bi-files me-2"></i>Your Documents</h5>
                            <button class="btn btn-outline-secondary btn-sm rounded-circle shadow-sm" id="refreshFiles">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                        <div id="filesList" class="files-container custom-scrollbar" style="max-height: 220px; overflow-y: auto;">
                            <div class="text-muted small">Loading files...</div>
                        </div>
                    </div>
                    
                    <!-- System Stats with improved visual design -->
                    <div class="stats-section mb-4">
                        <h5><i class="bi bi-bar-chart me-2"></i>System Status</h5>
                        <div class="stats-grid d-flex">
                            <div class="stat-item bg-light rounded p-3 text-center flex-grow-1 me-2 shadow-sm">
                                <div class="stat-value fs-4 fw-bold text-primary" id="docCount">0</div>
                                <div class="stat-label">Documents</div>
                                <div class="progress mt-2" style="height: 3px;">
                                    <div class="progress-bar" style="width: 0%" id="docProgress"></div>
                                </div>
                            </div>
                            <div class="stat-item bg-light rounded p-3 text-center flex-grow-1 shadow-sm">
                                <div class="stat-value fs-4 fw-bold text-primary" id="systemStatus">Ready</div>
                                <div class="stat-label">Status</div>
                                <div class="progress mt-2" style="height: 3px;">
                                    <div class="progress-bar bg-success" style="width: 100%" id="statusProgress"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Process Visualization -->
                    <div class="process-section mb-4 d-none" id="processSection">
                        <h5><i class="bi bi-cpu me-2"></i>Process Status</h5>
                        <div class="task-steps" id="desktopTaskSteps">
                            <!-- Task steps will be added dynamically via JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Controls -->
                    <div class="controls-section">
                        <button class="btn btn-outline-danger w-100 shadow-sm transition-all" id="clearChat">
                            <i class="bi bi-trash me-2"></i>Clear Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- App JS -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/ui-enhancer.js"></script>
    <script src="/static/js/mobile-enhancer.js"></script>
    <script src="/static/js/typing-indicator.js"></script>
    <script src="/static/js/sw-register.js"></script>
    
    <!-- Custom Responsive Scripts -->
    <script>
        // Sync mobile and desktop elements
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile clear chat button should trigger the same functionality
            const mobileClearChat = document.getElementById('mobileClearChat');
            if (mobileClearChat) {
                mobileClearChat.addEventListener('click', function() {
                    const desktopClearChat = document.getElementById('clearChat');
                    if (desktopClearChat) desktopClearChat.click();
                });
            }
            
            // Sync connection status displays
            const updateMobileStatus = function() {
                const desktop = document.getElementById('connectionStatus');
                const mobile = document.getElementById('mobileConnectionStatus');
                if (desktop && mobile) {
                    mobile.className = desktop.className;
                    mobile.innerHTML = desktop.innerHTML;
                }
            };
            
            // Call initially and set interval
            updateMobileStatus();
            setInterval(updateMobileStatus, 5000);
            
            // Update height for better mobile experience
            const updateHeight = function() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            updateHeight();
            window.addEventListener('resize', updateHeight);
            
            // Example workflow waypoints
            window.setupWorkflow = function(steps) {
                const workflowContainer = document.getElementById('workflowWaypoints');
                const trackElement = workflowContainer.querySelector('.workflow-track');
                const progressElement = document.getElementById('workflowProgress');
                
                // Clear existing waypoints
                const existingWaypoints = trackElement.querySelectorAll('.waypoint');
                existingWaypoints.forEach(waypoint => waypoint.remove());
                
                // Create waypoints
                if (steps && steps.length > 0) {
                    workflowContainer.classList.remove('d-none');
                    
                    steps.forEach((step, index) => {
                        const position = (index / (steps.length - 1)) * 100;
                        
                        // Create waypoint
                        const waypoint = document.createElement('div');
                        waypoint.className = 'waypoint';
                        waypoint.style.left = `${position}%`;
                        waypoint.setAttribute('data-step', index);
                        if (index === 0) waypoint.classList.add('active');
                        
                        // Create label
                        const label = document.createElement('div');
                        label.className = 'waypoint-label';
                        label.textContent = step.label || `Step ${index + 1}`;
                        label.style.left = `${position}%`;
                        if (index === 0) label.classList.add('active');
                        
                        // Add to DOM
                        trackElement.appendChild(waypoint);
                        trackElement.appendChild(label);
                    });
                } else {
                    workflowContainer.classList.add('d-none');
                }
            };
            
            // Update workflow progress
            window.updateWorkflowProgress = function(currentStep, totalSteps) {
                const progressElement = document.getElementById('workflowProgress');
                const waypoints = document.querySelectorAll('.waypoint');
                const labels = document.querySelectorAll('.waypoint-label');
                
                if (progressElement && waypoints.length > 0) {
                    const progress = (currentStep / (totalSteps - 1)) * 100;
                    progressElement.style.width = `${progress}%`;
                    
                    // Update waypoint states
                    waypoints.forEach((waypoint, index) => {
                        if (index < currentStep) {
                            waypoint.classList.add('completed');
                            waypoint.classList.remove('active');
                        } else if (index === currentStep) {
                            waypoint.classList.add('active');
                            waypoint.classList.remove('completed');
                        } else {
                            waypoint.classList.remove('active', 'completed');
                        }
                    });
                    
                    // Update label states
                    labels.forEach((label, index) => {
                        if (index === currentStep) {
                            label.classList.add('active');
                        } else {
                            label.classList.remove('active');
                        }
                    });
                }
            };
            
            // Example task steps
            window.showTaskSteps = function(steps) {
                const taskStepsContainer = document.getElementById('taskStepsContainer');
                const taskStepsElement = document.getElementById('taskSteps');
                const desktopTaskStepsElement = document.getElementById('desktopTaskSteps');
                const processSection = document.getElementById('processSection');
                
                // Clear existing steps
                taskStepsElement.innerHTML = '';
                desktopTaskStepsElement.innerHTML = '';
                
                // Create steps
                if (steps && steps.length > 0) {
                    taskStepsContainer.classList.remove('d-none');
                    processSection.classList.remove('d-none');
                    
                    steps.forEach((step, index) => {
                        // Create mobile step
                        const mobileStepElement = createTaskStepElement(step, index);
                        taskStepsElement.appendChild(mobileStepElement);
                        
                        // Create desktop step
                        const desktopStepElement = createTaskStepElement(step, index);
                        desktopTaskStepsElement.appendChild(desktopStepElement);
                    });
                } else {
                    taskStepsContainer.classList.add('d-none');
                    processSection.classList.add('d-none');
                }
            };
            
            // Create task step element
            function createTaskStepElement(step, index) {
                const stepElement = document.createElement('div');
                stepElement.className = 'task-step my-2';
                stepElement.setAttribute('data-step', index);
                if (index === 0) stepElement.classList.add('active');
                
                // Icon
                const iconElement = document.createElement('div');
                iconElement.className = 'step-icon';
                iconElement.innerHTML = `<i class="bi ${step.icon || 'bi-circle'}"></i>`;
                
                // Content
                const contentElement = document.createElement('div');
                contentElement.className = 'step-content';
                
                const titleElement = document.createElement('div');
                titleElement.className = 'step-title';
                titleElement.textContent = step.title || `Step ${index + 1}`;
                
                const descElement = document.createElement('div');
                descElement.className = 'step-description';
                descElement.textContent = step.description || '';
                
                const progressElement = document.createElement('div');
                progressElement.className = 'step-progress';
                progressElement.innerHTML = `<div class="step-progress-bar" style="width: ${index === 0 ? '0%' : '0%'}"></div>`;
                
                // Assemble
                contentElement.appendChild(titleElement);
                contentElement.appendChild(descElement);
                contentElement.appendChild(progressElement);
                
                stepElement.appendChild(iconElement);
                stepElement.appendChild(contentElement);
                
                return stepElement;
            }
            
            // Update task step progress
            window.updateTaskStepProgress = function(stepIndex, progress) {
                const taskSteps = document.querySelectorAll('.task-step');
                const desktopTaskSteps = document.querySelectorAll('#desktopTaskSteps .task-step');
                
                if (taskSteps.length > 0 && stepIndex < taskSteps.length) {
                    // Update mobile step
                    updateStepElement(taskSteps, stepIndex, progress);
                    
                    // Update desktop step
                    updateStepElement(desktopTaskSteps, stepIndex, progress);
                }
            };
            
            function updateStepElement(elements, stepIndex, progress) {
                elements.forEach((step, index) => {
                    const progressBar = step.querySelector('.step-progress-bar');
                    
                    if (index < stepIndex) {
                        // Previous steps are completed
                        step.classList.add('completed');
                        step.classList.remove('active');
                        if (progressBar) progressBar.style.width = '100%';
                    } else if (index === stepIndex) {
                        // Current step is active
                        step.classList.add('active');
                        step.classList.remove('completed');
                        if (progressBar) progressBar.style.width = `${progress}%`;
                    } else {
                        // Future steps are inactive
                        step.classList.remove('active', 'completed');
                        if (progressBar) progressBar.style.width = '0%';
                    }
                });
            }
            
            // Demo/Example usage of workflow and task steps
            // This is just for demonstration - remove or modify for production
            setTimeout(() => {
                // Example workflow
                const exampleWorkflow = [
                    { label: 'Query' },
                    { label: 'Search Docs' },
                    { label: 'Analyze' },
                    { label: 'Generate' },
                    { label: 'Respond' }
                ];
                
                // Example task steps
                const exampleTaskSteps = [
                    { 
                        icon: 'bi-search', 
                        title: 'Process Query', 
                        description: 'Analyzing your question for key information'
                    },
                    { 
                        icon: 'bi-database-search', 
                        title: 'Search Documents', 
                        description: 'Finding relevant information in your documents'
                    },
                    { 
                        icon: 'bi-lightbulb', 
                        title: 'Context Building', 
                        description: 'Building context from search results'
                    },
                    { 
                        icon: 'bi-cpu', 
                        title: 'Generate Response', 
                        description: 'Creating an accurate and helpful response'
                    },
                    { 
                        icon: 'bi-check-circle', 
                        title: 'Final Review', 
                        description: 'Reviewing and polishing the response'
                    }
                ];
                
                // Setup workflow and task steps for demo
                // window.setupWorkflow(exampleWorkflow);
                // window.showTaskSteps(exampleTaskSteps);
                
                // Simulate progress updates for demo
                // let currentStep = 0;
                // const progressInterval = setInterval(() => {
                //     if (currentStep < exampleWorkflow.length - 1) {
                //         window.updateWorkflowProgress(currentStep, exampleWorkflow.length);
                //         window.updateTaskStepProgress(currentStep, 100);
                //         currentStep++;
                //     } else {
                //         window.updateWorkflowProgress(currentStep, exampleWorkflow.length);
                //         window.updateTaskStepProgress(currentStep, 100);
                //         clearInterval(progressInterval);
                //     }
                // }, 1500);
            }, 3000);
        });
    </script>
</body>
</html>
